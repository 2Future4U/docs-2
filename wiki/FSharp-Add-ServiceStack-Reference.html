<p><a href="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/wikis/fsharp-header.png" target="_blank"><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/wikis/fsharp-header.png" alt="F# Header" style="max-width:100%;"></a></p>

<p>ServiceStack's <strong>Add ServiceStack Reference</strong> feature allows clients to generate Native Types from directly within VS.NET using <a href="https://github.com/ServiceStack/ServiceStack/wiki/Creating-your-first-project">ServiceStackVS VS.NET Extension</a> - providing a simpler, cleaner and more versatile alternative to WCF's Add Service Reference feature that's built into VS.NET.</p>

<p>The article outlines ServiceStack's support generating F# DTO's - providing a flexible alternative than sharing your compiled DTO .NET assembly with clients. Now F# clients can easily add a reference to a remote ServiceStack instance and update typed DTO's directly from within VS.NET - reducing the burden and effort required to consume ServiceStack Services whilst benefiting from clients native language strong-typing feedback. </p>

<h2>
<a id="user-content-add-servicestack-reference" class="anchor" href="#add-servicestack-reference" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>[[Add ServiceStack Reference]]</h2>

<p>The easiest way to Add a ServiceStack reference to your project is to right-click on your project to bring up <a href="https://github.com/ServiceStack/ServiceStack/wiki/Creating-your-first-project">ServiceStackVS's</a> <code>Add ServiceStack Reference</code> context-menu item. This opens a dialog where you can add the url of the ServiceStack instance you want to typed DTO's for, as well as the name of the DTO source file that's added to your project.</p>

<p><a href="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/apps/StackApis/add-service-ref-flow.png"><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/apps/StackApis/add-service-ref-flow.png" alt="Add ServiceStack Reference" style="max-width:100%;"></a></p>

<p>After clicking OK, the servers DTO's and <a href="https://www.nuget.org/packages/ServiceStack.Client">ServiceStack.Client</a> NuGet package are added to the project, providing an instant typed API:</p>

<p><a href="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/release-notes/fsharp-add-servicestack-reference.png"><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/release-notes/fsharp-add-servicestack-reference.png" alt="Calling ServiceStack Service with FSharp" style="max-width:100%;"></a></p>

<h3>
<a id="user-content-update-servicestack-reference" class="anchor" href="#update-servicestack-reference" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update ServiceStack Reference</h3>

<p>Updating a ServiceStack reference works intuitively where you just have to click on the DTO's you want to update and click <strong>Update ServiceStack Reference</strong> on the context menu:</p>

<p><a href="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/release-notes/fsharp-update-servicestack-reference.png"><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/release-notes/fsharp-update-servicestack-reference.png" alt="Calling ServiceStack Service with FSharp" style="max-width:100%;"></a></p>

<p>As there's no configuration stored about the ServiceStack Reference you might be wondering how this works? The <strong>Update ServiceStack Reference</strong> context menu only appears on F# source files ending with <code>.dto.fs</code> or <code>.dtos.fs</code>. It then uses the <code>BaseUrl</code> in the metadata comments for where to fetch and update to the latest F# server DTO's.</p>

<h3>
<a id="user-content-console-demo" class="anchor" href="#console-demo" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Console Demo</h3>

<p><a href="https://github.com/ServiceStack/Assets/raw/master/img/servicestackvs/servicestack%20reference/fsharp-demo.gif" target="_blank"><img src="https://github.com/ServiceStack/Assets/raw/master/img/servicestackvs/servicestack%20reference/fsharp-demo.gif" alt="FSharp Console Demo" style="max-width:100%;"></a></p>

<h3>
<a id="user-content-f-client-example" class="anchor" href="#f-client-example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>F# Client Example</h3>

<p>Just like with C#, F# Native Types can be used in ServiceStack's <a href="https://github.com/ServiceStack/ServiceStack/wiki/C%23-client">Generic Service Clients</a> providing and end-to-end Typed API whose PCL support also allows F# to be used in <a href="https://github.com/ServiceStackApps/HelloMobile">mobile clients apps</a> without having to share compiled DTOs:</p>

<div class="highlight highlight-source-fsharp"><pre><span class="pl-k">let</span> <span class="pl-smi">client</span> <span class="pl-k">=</span> <span class="pl-k">new</span> JsonServiceClient(<span class="pl-s"><span class="pl-pds">"</span>http://stackapis.servicestack.net<span class="pl-pds">"</span></span>)
<span class="pl-k">let</span> <span class="pl-smi">response</span> <span class="pl-k">=</span> client.Get(<span class="pl-k">new</span> SearchQuestions(
    Tags <span class="pl-k">=</span> <span class="pl-k">new</span> List<span class="pl-k">&lt;</span>string<span class="pl-k">&gt;</span>(<span class="pl-k">[</span> <span class="pl-s"><span class="pl-pds">"</span>redis<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-s"><span class="pl-pds">"</span>ormlite<span class="pl-pds">"</span></span> <span class="pl-k">]</span>)))        

TypeSerializer.PrintDump(response)</pre></div>

<h3>
<a id="user-content-change-default-server-configuration" class="anchor" href="#change-default-server-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Change Default Server Configuration</h3>

<p>The above defaults are also overridable on the ServiceStack Server by modifying the default config on the <code>NativeTypesFeature</code> Plugin, e.g:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> typesConfig = <span class="pl-c1">this</span>.GetPlugin&lt;NativeTypesFeature&gt;().MetadataTypesConfig;
typesConfig.AddDataContractAttributes = <span class="pl-c1">false</span>;
...</pre></div>

<h2>
<a id="user-content-constraints" class="anchor" href="#constraints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Constraints</h2>

<p>As the ordering contraint in F# conflicted with the ordering of types by C# namespaces, the cleanest approach was to add all DTO's under a single namespace. By default the namespace used will be the base <strong>ServiceModel</strong> namespace which is overridable with the <code>GlobalNamespace</code> Config:</p>

<div class="highlight highlight-source-cs"><pre>typesConfig.GlobalNamespace = <span class="pl-s"><span class="pl-pds">"</span>Client.Namespace<span class="pl-pds">"</span></span>;</pre></div>

<p>This does mean that each type name needs to be unique which is a best-practice that's now a requirement in order to make use of F# native types. Another semantic difference is that any C# nested classes become top-level classes when translated to F#.  </p>

<h3>
<a id="user-content-fsharp-configuration" class="anchor" href="#fsharp-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FSharp Configuration</h3>

<p>The header comments in the generated DTO's allows for further customization of how they're generated where ServiceStackVS automatically watches for any file changes and updates the generated DTO's with any custom Options provided. Options that are preceded by a F# single line comment <code>//</code> are defaults from the server that can be overridden, e.g:</p>

<div class="highlight highlight-source-fsharp"><pre><span class="pl-c"><span class="pl-c">(*</span> Options:</span>
<span class="pl-c">Date: 2014-10-21 00:45:38</span>
<span class="pl-c">Version: 1</span>
<span class="pl-c">BaseUrl: http://stackapis.servicestack.net</span>
<span class="pl-c"></span>
<span class="pl-c">//MakeDataContractsExtensible: False</span>
<span class="pl-c">//AddReturnMarker: True</span>
<span class="pl-c">//AddDescriptionAsComments: True</span>
<span class="pl-c">//AddDataContractAttributes: False</span>
<span class="pl-c">//AddIndexesToDataMembers: False</span>
<span class="pl-c">//AddGeneratedCodeAttributes: False</span>
<span class="pl-c">//AddResponseStatus: False</span>
<span class="pl-c">//AddImplicitVersion: </span>
<span class="pl-c">//InitializeCollections: True</span>
<span class="pl-c"><span class="pl-c">*)</span></span></pre></div>

<p>To override a value, remove the <code>//</code> and specify the value to the right of the <code>:</code>. Any value uncommented will be sent to the server to override any server defaults.</p>

<p>We'll go through and cover each of the above options to see how they affect the generated DTO's:</p>

<h3>
<a id="user-content-makedatacontractsextensible" class="anchor" href="#makedatacontractsextensible" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MakeDataContractsExtensible</h3>

<p>Add .NET's DataContract's <a href="http://msdn.microsoft.com/en-us/library/system.runtime.serialization.extensiondataobject(v=vs.110).aspx">ExtensionDataObject</a> to all DTO's:</p>

<div class="highlight highlight-source-fsharp"><pre><span class="pl-c1">[&lt;AllowNullLiteral&gt;]</span>
<span class="pl-k">type</span> <span class="pl-en">GetAnswersResponse</span><span class="pl-c1">()</span> <span class="pl-k">=</span> 
    <span class="pl-k">interface</span> IExtensibleDataObject <span class="pl-k">with</span>
        <span class="pl-k">member</span> <span class="pl-smi">val</span> <span class="pl-v">ExtensionData</span>:<span class="pl-v">ExtensionDataObject</span> <span class="pl-k">=</span> <span class="pl-c1">null</span> <span class="pl-k">with</span> get, set
    <span class="pl-k">end</span>
    <span class="pl-k">member</span> <span class="pl-smi">val</span> <span class="pl-v">Ansnwer</span>:<span class="pl-v">Answer</span> <span class="pl-k">=</span> <span class="pl-c1">null</span> <span class="pl-k">with</span> get,set
    <span class="pl-k">member</span> <span class="pl-smi">val</span> <span class="pl-v">ExtensionData</span>:<span class="pl-v">ExtensionDataObject</span> <span class="pl-k">=</span> <span class="pl-c1">null</span> <span class="pl-k">with</span> get,set</pre></div>

<h3>
<a id="user-content-addreturnmarker" class="anchor" href="#addreturnmarker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AddReturnMarker</h3>

<p>AddReturnMarker annotates Request DTO's with an <code>IReturn&lt;TResponse&gt;</code> marker referencing the Response type ServiceStack infers your Service to return:</p>

<div class="highlight highlight-source-fsharp"><pre><span class="pl-k">type</span> <span class="pl-en">GetAnswers</span><span class="pl-c1">()</span> <span class="pl-k">=</span> 
    <span class="pl-k">interface</span> IReturn<span class="pl-k">&lt;</span>GetAnswersResponse<span class="pl-k">&gt;</span>
    <span class="pl-k">member</span> <span class="pl-smi">val</span> <span class="pl-v">QuestionId</span>:<span class="pl-v">Int32</span> <span class="pl-k">=</span> <span class="pl-k">new</span> Int32<span class="pl-c1">()</span> <span class="pl-k">with</span> get,set</pre></div>

<blockquote>
<p>Original DTO doesn't require a return marker as response type can be inferred from Services return type or when using the <code>%Response</code> DTO Naming convention</p>
</blockquote>

<h3>
<a id="user-content-adddescriptionascomments" class="anchor" href="#adddescriptionascomments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AddDescriptionAsComments</h3>

<p>Converts any textual Description in <code>[Description]</code> attributes as F# Doc comments which allows your API to add intellisense in client projects:</p>

<div class="highlight highlight-source-fsharp"><pre><span class="pl-c">///&lt;summary&gt;</span>
<span class="pl-c">///Get a list of Answers for a Question</span>
<span class="pl-c">///&lt;/summary&gt;</span>
<span class="pl-k">type</span> <span class="pl-en">GetAnswers</span><span class="pl-c1">()</span> <span class="pl-k">=</span> 
<span class="pl-k">..</span>.</pre></div>

<h3>
<a id="user-content-adddatacontractattributes" class="anchor" href="#adddatacontractattributes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AddDataContractAttributes</h3>

<p>Decorates all DTO types with <code>[DataContract]</code> and properties with <code>[DataMember]</code>:</p>

<div class="highlight highlight-source-fsharp"><pre><span class="pl-c1">[&lt;DataContract&gt;]</span>
<span class="pl-c1">[&lt;AllowNullLiteral&gt;]</span>
<span class="pl-k">type</span> <span class="pl-en">GetAnswers</span><span class="pl-c1">()</span> <span class="pl-k">=</span> 
    <span class="pl-k">interface</span> IReturn<span class="pl-k">&lt;</span>GetAnswersResponse<span class="pl-k">&gt;</span>
    <span class="pl-c1">[&lt;DataMember&gt;]</span>
    <span class="pl-k">member</span> <span class="pl-smi">val</span> <span class="pl-v">QuestionId</span>:<span class="pl-v">Int32</span> <span class="pl-k">=</span> <span class="pl-k">new</span> Int32<span class="pl-c1">()</span> <span class="pl-k">with</span> get,set</pre></div>

<h3>
<a id="user-content-addindexestodatamembers" class="anchor" href="#addindexestodatamembers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AddIndexesToDataMembers</h3>

<p>Populates a DataMember Order index for all properties:</p>

<div class="highlight highlight-source-fsharp"><pre><span class="pl-c1">[&lt;DataContract&gt;]</span>
<span class="pl-k">type</span> <span class="pl-en">GetAnswers</span><span class="pl-c1">()</span> <span class="pl-k">=</span> 
    <span class="pl-k">interface</span> IReturn<span class="pl-k">&lt;</span>GetAnswersResponse<span class="pl-k">&gt;</span>
    <span class="pl-c1">[&lt;DataMember(Order<span class="pl-k">=</span><span class="pl-c1">1</span>)&gt;]</span>
    <span class="pl-k">member</span> <span class="pl-smi">val</span> <span class="pl-v">QuestionId</span>:<span class="pl-v">Int32</span> <span class="pl-k">=</span> <span class="pl-k">new</span> Int32<span class="pl-c1">()</span> <span class="pl-k">with</span> get,set</pre></div>

<blockquote>
<p>Requires AddDataContractAttributes=true</p>
</blockquote>

<h3>
<a id="user-content-addgeneratedcodeattributes" class="anchor" href="#addgeneratedcodeattributes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AddGeneratedCodeAttributes</h3>

<p>Emit <code>[&lt;GeneratedCode&gt;]</code> attribute on all generated Types:</p>

<div class="highlight highlight-source-fsharp"><pre><span class="pl-c1">[&lt;GeneratedCode&gt;]</span>
<span class="pl-k">type</span> <span class="pl-en">GetAnswers</span><span class="pl-c1">()</span> <span class="pl-k">=</span> <span class="pl-k">..</span>.</pre></div>

<h3>
<a id="user-content-addresponsestatus" class="anchor" href="#addresponsestatus" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AddResponseStatus</h3>

<p>Automatically add a <code>ResponseStatus</code> property on all Response DTO's, regardless if it wasn't already defined:</p>

<div class="highlight highlight-source-fsharp"><pre><span class="pl-k">type</span> <span class="pl-en">GetAnswersResponse</span><span class="pl-c1">()</span> <span class="pl-k">=</span> 
    <span class="pl-k">..</span>.
    <span class="pl-k">member</span> <span class="pl-smi">val</span> <span class="pl-v">ResponseStatus</span>:<span class="pl-v">ResponseStatus</span> <span class="pl-k">=</span> <span class="pl-c1">null</span> <span class="pl-k">with</span> get,set</pre></div>

<h3>
<a id="user-content-addimplicitversion" class="anchor" href="#addimplicitversion" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AddImplicitVersion</h3>

<p>Lets you specify the Version number to be automatically populated in all Request DTO's sent from the client: </p>

<div class="highlight highlight-source-cs"><pre>type GetAnswers() = 
    <span class="pl-k">interface</span> <span class="pl-en">IReturn</span>&lt;GetAnswersResponse&gt;
    member val Version:<span class="pl-k">int</span> = 1 <span class="pl-k">with</span> <span class="pl-k">get</span>, <span class="pl-k">set</span>
    ...</pre></div>

<p>This lets you know what Version of the Service Contract that existing clients are using making it easy to implement ServiceStack's <a href="http://stackoverflow.com/a/12413091/85785">recommended versioning strategy</a>. </p>

<h3>
<a id="user-content-initializecollections" class="anchor" href="#initializecollections" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>InitializeCollections</h3>

<p>Lets you automatically initialize collections in Request DTO's:</p>

<div class="highlight highlight-source-fsharp"><pre><span class="pl-k">type</span> <span class="pl-en">SearchQuestions</span><span class="pl-c1">()</span> <span class="pl-k">=</span> 
    <span class="pl-k">interface</span> IReturn<span class="pl-k">&lt;</span>SearchQuestionsResponse<span class="pl-k">&gt;</span>
    <span class="pl-k">member</span> <span class="pl-smi">val</span> <span class="pl-v">Tags</span>:<span class="pl-v">List</span>&lt;<span class="pl-v">String</span>&gt; <span class="pl-k">=</span> <span class="pl-k">new</span> List<span class="pl-k">&lt;</span>String<span class="pl-k">&gt;</span><span class="pl-c1">()</span> <span class="pl-k">with</span> get,set</pre></div>
