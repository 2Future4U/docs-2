<h3>
<a id="user-content-autoquery-memory-data-source" class="anchor" href="#autoquery-memory-data-source" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AutoQuery Memory Data Source</h3>

<p>The simplest data source we can query is an in-memory .NET collection registered with <code>ctx.MemorySource()</code>. 
But how the collection is populated remains up to you. The example below shows registering collections from 
multiple sources inc. <strong>in-line code</strong>, populated <strong>from a CSV file</strong> (utilizing ServiceStack's new 
CSV deserialization support) and populated <strong>from a 3rd Party API</strong> using 
<a href="https://github.com/ServiceStack/ServiceStack/wiki/Http-Utils">HTTP Utils</a>:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-c">//Declaration in code</span>
<span class="pl-k">var</span> countries = <span class="pl-k">new</span>[] {
    <span class="pl-k">new</span> Country { ... },
    <span class="pl-k">new</span> Country { ... },
};

<span class="pl-c">//From CSV File</span>
List&lt;Currency&gt; currencies = File.ReadAllText(<span class="pl-s"><span class="pl-pds">"</span>currencies.csv<span class="pl-pds">"</span></span>).FromCsv&lt;List&lt;Currency&gt;&gt;();

<span class="pl-c">//From 3rd Party API</span>
List&lt;GithubRepo&gt; repos = <span class="pl-s"><span class="pl-pds">"</span>https://api.github.com/orgs/ServiceStack/repos<span class="pl-pds">"</span></span>
    .GetJsonFromUrl(req =&gt; req.UserAgent=<span class="pl-s"><span class="pl-pds">"</span>AutoQuery<span class="pl-pds">"</span></span>).FromJson&lt;List&lt;GithubRepo&gt;&gt;();

<span class="pl-c">//AutoQuery Data Plugin</span>
Plugins.Add(<span class="pl-k">new</span> AutoQueryDataFeature { MaxLimit = <span class="pl-c1">100</span> }
    .AddDataSource(ctx =&gt; ctx.MemorySource(countries))
    .AddDataSource(ctx =&gt; ctx.MemorySource(currencies))
    .AddDataSource(ctx =&gt; ctx.MemorySource(repos))
);</pre></div>

<p>After data sources are registered, you can then create AutoQuery Data Services to query them:</p>

<div class="highlight highlight-source-cs"><pre>[Route(<span class="pl-s"><span class="pl-pds">"</span>/countries<span class="pl-pds">"</span></span>)]
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">QueryCountries</span> : <span class="pl-k">QueryData</span>&lt;<span class="pl-k">Country</span>&gt; {}

[Route(<span class="pl-s"><span class="pl-pds">"</span>/currencies<span class="pl-pds">"</span></span>)]
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">QueryCurrencies</span> : <span class="pl-k">QueryData</span>&lt;<span class="pl-k">Currency</span>&gt; {}

[Route(<span class="pl-s"><span class="pl-pds">"</span>/repos<span class="pl-pds">"</span></span>)]
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">QueryGithubRepos</span> : <span class="pl-k">QueryData</span>&lt;<span class="pl-k">GithubRepo</span>&gt; {}</pre></div>

<p>With just the empty Request DTO's above they're now queryable like any other AutoQuery Service, e.g:</p>

<ul>
<li>/countries?code=AU</li>
<li>/currencies.json?code=AUD</li>
<li>/repos.csv?watchers_count&gt;=100&amp;orderBy=-watchers_count,name&amp;fields=name,homepage,language</li>
</ul>

<h3>
<a id="user-content-cacheable-data-sources" class="anchor" href="#cacheable-data-sources" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cacheable Data Sources</h3>

<p>The examples above provides a nice demonstration of querying static memory collections. But Data Sources 
offers even more flexibility where you're also able to query and cache dynamic .NET collections that 
are customizable per-request.</p>

<p>The registration below shows an example of this where results are dynamically fetched from <strong>GitHub's API</strong> 
and persisted in the <strong>local in-memory cache</strong> for <strong>5 minutes</strong> - throttling the number of requests made 
to the external 3rd Party API:</p>

<div class="highlight highlight-source-cs"><pre>.AddDataSource(ctx =&gt; ctx.MemorySource(() =&gt; 
 $<span class="pl-s"><span class="pl-pds">"</span>https://api.github.com/repos/ServiceStack/{ctx.Request.GetParam(<span class="pl-pds">"</span></span>repo<span class="pl-s"><span class="pl-pds">"</span>)}/contributors<span class="pl-pds">"</span></span>
   .GetJsonFromUrl(req =&gt; req.UserAgent=<span class="pl-s"><span class="pl-pds">"</span>AutoQuery<span class="pl-pds">"</span></span>).FromJson&lt;List&lt;GithubContributor&gt;&gt;(),
  HostContext.LocalCache, 
  TimeSpan.FromMinutes(<span class="pl-c1">5</span>)
));</pre></div>

<p>We can now create an AutoQuery Data Service to query the above cached <code>GithubContributor</code> Memory Source:</p>

<div class="highlight highlight-source-cs"><pre>[Route(<span class="pl-s"><span class="pl-pds">"</span>/contributors<span class="pl-pds">"</span></span>)]
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">QueryContributors</span> : <span class="pl-k">QueryData</span>&lt;<span class="pl-k">GithubContributor</span>&gt;
{
    <span class="pl-k">public</span> <span class="pl-k">string</span> <span class="pl-en">Repo</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}</pre></div>

<p>Thanks to the Typed Request DTO we also get an end-to-end Typed API for free which we can use to query 
the contributors result-set returned from GitHub's API. As an example we can view the 
<strong>Top 20 Contributors</strong> for the <strong>ServiceStack</strong> Project with:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> top20Contributors = client.Get(<span class="pl-k">new</span> QueryContributors {
    Repo = <span class="pl-s"><span class="pl-pds">"</span>ServiceStack<span class="pl-pds">"</span></span>,
    OrderByDesc = <span class="pl-s"><span class="pl-pds">"</span>Contributions<span class="pl-pds">"</span></span>,
    Take = <span class="pl-c1">20</span>
});

top20Contributors.PrintDump(); <span class="pl-c">// Pretty print results to Console</span></pre></div>
