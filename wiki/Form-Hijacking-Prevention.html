<p>The <code>SuppressFormsAuthenticationRedirectModule</code> module prevents the asp.net built in <code>FormsAuthenticationModule</code> from hijacking 401 requests and redirecting to a login page.  Normally, this is the desired behavior if you are using a web browser and access an unauthorized page, but in the case of an API, we do not want that.</p>

<p>This module uses a hack to get this done.  It temporarily replaces the 401 error with a 402 to trick the <code>FormsAuthenticationModule</code> and then puts the 401 back before the request is finished.   It only does this on the path for your API, the rest of the website will behave as normal.   Note, that there is a non-hack way to do this now, built into .net 4.5 and I have commented the code as to what that is.  When appropriate a .net 4.5 package could be released containing this updated code.</p>

<p>To use this, first register the httpmodule:</p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">system</span>.web&gt;
    &lt;<span class="pl-ent">httpModules</span>&gt;
      &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>FormsAuthenticationDisposition<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>ServiceStack.SuppressFormsAuthenticationRedirectModule, ServiceStack<span class="pl-pds">"</span></span> /&gt;
    &lt;/<span class="pl-ent">httpModules</span>&gt;
&lt;/<span class="pl-ent">system</span>.web&gt;

<span class="pl-c">&lt;!-- Required for IIS 7.0 (and above?) --&gt;</span>
&lt;<span class="pl-ent">system</span>.webServer&gt;
  &lt;<span class="pl-ent">validation</span> <span class="pl-e">validateIntegratedModeConfiguration</span>=<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span> /&gt;
    &lt;<span class="pl-ent">httpModules</span>&gt;
      &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>FormsAuthenticationDisposition<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>ServiceStack.SuppressFormsAuthenticationRedirectModule, ServiceStack<span class="pl-pds">"</span></span> /&gt;
    &lt;/<span class="pl-ent">httpModules</span>&gt;
&lt;/<span class="pl-ent">system</span>.webServer&gt;</pre></div>

<p>next, configure the module with where your API lives - defaults to <code>/api</code>, so in your AppHost Configure:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">override</span> <span class="pl-k">void</span> Configure(Funq.Container container)
{
    SetConfig(<span class="pl-k">new</span> HostConfig {
        HandlerFactoryPath = <span class="pl-s"><span class="pl-pds">"</span>/yourapipath<span class="pl-pds">"</span></span>,
    });

    <span class="pl-c">//this is the configuration for Hijacking prevention</span>
    SuppressFormsAuthenticationRedirectModule.PathToSupress = Config.HandlerFactoryPath;
}</pre></div>
