<p>.</p>

<h1>
<a id="user-content-openid-20-authentication-support" class="anchor" href="#openid-20-authentication-support" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>OpenId 2.0 Authentication Support</h1>

<p>Contained in the <a href="http://nuget.org/packages/ServiceStack.Authentication.OpenId">ServiceStack.Authentication.OpenId</a> NuGet package is ServiceStack's support of OpenId 2.0 Authentication. This allows ServiceStack-enabled ASP.NET / MVC sites and web services to authenticate and accept registration from any OpenId 2.0 Authentication provider. Like most .NET OpenId libraries, we leverage the de-facto and excellent <a href="http://www.dotnetopenauth.net/">DotNetOpenAuth</a> library to enable our OpenId and OAuth2 support. </p>

<h3>
<a id="user-content-install-via-nuget" class="anchor" href="#install-via-nuget" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install via NuGet</h3>

<pre><code>PM&gt; Install-Package ServiceStack.Authentication.OpenId
</code></pre>

<h2>
<a id="user-content-easy-configuration-plugs-into-servicestacks-auth-provider-model" class="anchor" href="#easy-configuration-plugs-into-servicestacks-auth-provider-model" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Easy configuration, plugs into ServiceStack's Auth Provider model</h2>

<p>As you might expect adding OpenId support works seamlessly with ServiceStack's existing <a href="https://github.com/ServiceStack/ServiceStack/wiki/Authentication-and-authorization">Auth Providers</a> where you can enable support for any Specific OpenId 2.0 provider with just <strong>1-line of registration</strong> each. Below is the example taken from <a href="https://github.com/ServiceStack/SocialBootstrapApi/blob/master/src/SocialBootstrapApi/AppHost.cs#L171">SocialBootstrapApi's AppHost</a> showing how to extend their existing Auth Providers with new OpenId 2.0 options:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> appSettings = <span class="pl-k">new</span> AppSettings(); <span class="pl-c">//Access Web.Config AppSettings</span>
Plugins.Add(<span class="pl-k">new</span> AuthFeature(() =&gt; <span class="pl-k">new</span> CustomUserSession(), 
    <span class="pl-c">//Add all the Auth Providers you want to allow registration with</span>
    <span class="pl-k">new</span> IAuthProvider[] {
        <span class="pl-c">//Existing Auth Providers</span>
        <span class="pl-k">new</span> CredentialsAuthProvider(),              <span class="pl-c">//HTML Form post of UserName/Password credentials</span>
        <span class="pl-k">new</span> TwitterAuthProvider(appSettings),       <span class="pl-c">//Sign-in with Twitter</span>
        <span class="pl-k">new</span> FacebookAuthProvider(appSettings),      <span class="pl-c">//Sign-in with Facebook</span>
        <span class="pl-k">new</span> DigestAuthProvider(appSettings),        <span class="pl-c">//Sign-in with Digest Auth</span>
        <span class="pl-k">new</span> BasicAuthProvider(),                    <span class="pl-c">//Sign-in with Basic Auth</span>

        <span class="pl-c">//Register new OpenId providers you want to allow authentication with</span>
        <span class="pl-k">new</span> GoogleOpenIdOAuthProvider(appSettings), <span class="pl-c">//Sign-in with Google OpenId</span>
        <span class="pl-k">new</span> YahooOpenIdOAuthProvider(appSettings),  <span class="pl-c">//Sign-in with Yahoo OpenId</span>
        <span class="pl-k">new</span> OpenIdOAuthProvider(appSettings),       <span class="pl-c">//Sign-in with any Custom OpenId Provider</span>

        <span class="pl-c">//Register new OAuth2 providers you want to allow authentication with</span>
        <span class="pl-k">new</span> GoogleOAuth2Provider(appSettings),      <span class="pl-c">//Sign-in with Google OAuth2        </span>
        <span class="pl-k">new</span> LinkedInOAuth2Provider(appSettings),    <span class="pl-c">//Sign-in with LinkedIn OAuth2        </span>
    }));</pre></div>

<p><a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.AuthWeb.Tests/">AuthWebTests</a> is a simple project that shows all Auth Providers configured and working in the same app. See the <a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.AuthWeb.Tests/AppHost.cs">AppHost</a> for an example of the code and the <a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.AuthWeb.Tests/Web.config">Web.config</a> for an example of the configuration required to enable each Auth Provider.</p>

<h3>
<a id="user-content-creating-a-custom-openid-provider" class="anchor" href="#creating-a-custom-openid-provider" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating a Custom OpenId Provider</h3>

<p>Creating a custom OpenId provider is trivially done by just inheriting from <code>OpenIdOAuthProvider</code> and providing a unique Id and Auth Realm Url for the provider. This is the source code for <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Authentication.OpenId/GoogleOpenIdOAuthProvider.cs">GoogleOpenIdOAuthProvider</a>:</p>

<div class="highlight highlight-source-cs"><pre>    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">GoogleOpenIdOAuthProvider</span> : <span class="pl-k">OpenIdOAuthProvider</span> {
        <span class="pl-k">public</span> <span class="pl-k">const</span> <span class="pl-k">string</span> Name = <span class="pl-s"><span class="pl-pds">"</span>GoogleOpenId<span class="pl-pds">"</span></span>;
        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">string</span> Realm = <span class="pl-s"><span class="pl-pds">"</span>https://www.google.com/accounts/o8/id<span class="pl-pds">"</span></span>;

        <span class="pl-k">public</span> <span class="pl-en">GoogleOpenIdOAuthProvider</span>(<span class="pl-k">IResourceManager</span> <span class="pl-smi">appSettings</span>)
            : <span class="pl-c1">base</span>(appSettings, Name, Realm) { }
    }</pre></div>

<p>With just <code>GoogleOpenIdOAuthProvider</code> class and it's registration above we can now enable authentication for our websites by just adding a HTML Form to <strong>POST</strong> to the <code>/auth/{AuthProviderName}</code> AuthService, e.g:</p>

<div class="highlight highlight-text-html-basic"><pre>    &lt;<span class="pl-ent">form</span> <span class="pl-e">action</span>=<span class="pl-s"><span class="pl-pds">"</span>/api/auth/googleopenid<span class="pl-pds">"</span></span> <span class="pl-e">method</span>=<span class="pl-s"><span class="pl-pds">"</span>POST<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">input</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>image<span class="pl-pds">"</span></span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>/Content/img/sign-in-with-google.png<span class="pl-pds">"</span></span> <span class="pl-e">alt</span>=<span class="pl-s"><span class="pl-pds">"</span>Sign in with Google<span class="pl-pds">"</span></span>&gt;
    &lt;/<span class="pl-ent">form</span>&gt;</pre></div>

<p>Any other custom OpenId provider can be added in the same way, here is the HTML Form for Yahoo OpenId:</p>

<div class="highlight highlight-text-html-basic"><pre>    &lt;<span class="pl-ent">form</span> <span class="pl-e">action</span>=<span class="pl-s"><span class="pl-pds">"</span>/api/auth/yahooopenid<span class="pl-pds">"</span></span> <span class="pl-e">method</span>=<span class="pl-s"><span class="pl-pds">"</span>POST<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">input</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>image<span class="pl-pds">"</span></span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>/Content/img/sign-in-with-yahoo.png<span class="pl-pds">"</span></span> <span class="pl-e">alt</span>=<span class="pl-s"><span class="pl-pds">"</span>Sign in with Yahoo!<span class="pl-pds">"</span></span>&gt;
    &lt;/<span class="pl-ent">form</span>&gt;</pre></div>

<p>Finally you can allow registration of any other OpenId 2.0 provider at run-time by including their Url in the <strong>OpenIdUrl</strong> Form POST variable, e.g:</p>

<div class="highlight highlight-text-html-basic"><pre>    &lt;<span class="pl-ent">form</span> <span class="pl-e">action</span>=<span class="pl-s"><span class="pl-pds">"</span>/api/auth/openid<span class="pl-pds">"</span></span> <span class="pl-e">method</span>=<span class="pl-s"><span class="pl-pds">"</span>POST<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">input</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>OpenIdUrl<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>http://myopenid.com<span class="pl-pds">"</span></span> /&gt;
        &lt;<span class="pl-ent">input</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>submit<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>btn<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>Sign In<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">form</span>&gt;</pre></div>

<p>The above sample markup from the <a href="https://github.com/ServiceStack/SocialBootstrapApi/blob/master/src/SocialBootstrapApi/Views/Shared/Index.cshtml#L366">Bootstrap Api project Index.cshtml</a> page, which when rendered looks like:</p>

<p><a href="http://bootstrapapi.apphb.com"><img src="https://camo.githubusercontent.com/7249af7699c55721594a775268d76d3dd32aa50c/687474703a2f2f7777772e73657276696365737461636b2e6e65742f66696c65732f6f70656e69642d666f726d2e706e67" alt="ServiceStack OpenId 2.0 Providers" data-canonical-src="http://www.servicestack.net/files/openid-form.png" style="max-width:100%;"></a></p>

<p>For a live demo of ServiceStack's Auth Providers in action check out the MVC + ServiceStack enabled <a href="http://bootstrapapi.apphb.com">Bootstrap API project</a>.</p>

<h3>
<a id="user-content-automatically-merges-registration-and-authentication-information-from-multiple-auth-providers" class="anchor" href="#automatically-merges-registration-and-authentication-information-from-multiple-auth-providers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Automatically Merges Registration and Authentication information from multiple Auth Providers</h3>

<p>One of the benefits of using <a href="https://github.com/ServiceStack/ServiceStack/wiki/Authentication-and-authorization">ServiceStack's Auth Providers</a> is that it allows a single user to login via multiple Auth Providers and it takes care of merging authentication and registration info from multiple Authentication sources into the same UserAuth Account. It also automatically maintains updates of users latest registration information on each login and their session is automatically populated with all of their previously authenticated providers, e.g. If a user logs in the 2nd time with Facebook, their session is also populated with their earlier Twitter account information.</p>
