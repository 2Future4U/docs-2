<h3>
<a id="user-content-add-servicestack-to-an-existing-mvc-project" class="anchor" href="#add-servicestack-to-an-existing-mvc-project" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add ServiceStack to an existing MVC Project</h3>

<p>You can easily add ServiceStack to any ASP.NET MVC project by getting it from NuGet with:</p>

<pre><code>PM&gt; Install-Package ServiceStack.Mvc
</code></pre>

<p>This install ServiceStack with additional (and optional) integration support for MVC letting you use ServiceStack's IOC to initialize MVC controllers or create MVC Controllers with built-in access to ServiceStack's components.</p>

<h3>
<a id="user-content-enabling-servicestack-in-webconfig" class="anchor" href="#enabling-servicestack-in-webconfig" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Enabling ServiceStack in Web.Config</h3>

<p>Typically when hosting ServiceStack with MVC you'd want to host it at the <code>/api</code> custom route which you can do by adding the IIS7+ configuration below to your <strong>Web.config</strong>:</p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">location</span> <span class="pl-e">path</span>=<span class="pl-s"><span class="pl-pds">"</span>api<span class="pl-pds">"</span></span>&gt;
  &lt;<span class="pl-ent">system</span>.web&gt;
    &lt;<span class="pl-ent">httpHandlers</span>&gt;
      &lt;<span class="pl-ent">add</span> <span class="pl-e">path</span>=<span class="pl-s"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>ServiceStack.HttpHandlerFactory, ServiceStack<span class="pl-pds">"</span></span> 
           <span class="pl-e">verb</span>=<span class="pl-s"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">httpHandlers</span>&gt;
  &lt;/<span class="pl-ent">system</span>.web&gt;

  &lt;<span class="pl-ent">system</span>.webServer&gt;
    &lt;<span class="pl-ent">modules</span> <span class="pl-e">runAllManagedModulesForAllRequests</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>/&gt;
    &lt;<span class="pl-ent">validation</span> <span class="pl-e">validateIntegratedModeConfiguration</span>=<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span> /&gt;
    &lt;<span class="pl-ent">handlers</span>&gt;
      &lt;<span class="pl-ent">add</span> <span class="pl-e">path</span>=<span class="pl-s"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>ServiceStack.Factory<span class="pl-pds">"</span></span> 
           <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>ServiceStack.HttpHandlerFactory, ServiceStack<span class="pl-pds">"</span></span> <span class="pl-e">verb</span>=<span class="pl-s"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span> 
           <span class="pl-e">preCondition</span>=<span class="pl-s"><span class="pl-pds">"</span>integratedMode<span class="pl-pds">"</span></span> 
           <span class="pl-e">resourceType</span>=<span class="pl-s"><span class="pl-pds">"</span>Unspecified<span class="pl-pds">"</span></span> <span class="pl-e">allowPathInfo</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> /&gt;
    &lt;/<span class="pl-ent">handlers</span>&gt;
  &lt;/<span class="pl-ent">system</span>.webServer&gt;
&lt;/<span class="pl-ent">location</span>&gt;</pre></div>

<blockquote>
<p>See <a href="https://github.com/ServiceStack/ServiceStack/wiki/Run-servicestack-side-by-side-with-another-web-framework">Run Side-by-Side with another web framework</a> for other web.config examples of hosting ServiceStack, e.g with IIS6/Mono.</p>
</blockquote>

<h3>
<a id="user-content-add-your-servicestack-apphost" class="anchor" href="#add-your-servicestack-apphost" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add your ServiceStack AppHost</h3>

<p>The smallest ServiceStack AppHost for MVC would look something like:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">AppHost</span> : <span class="pl-k">AppHostBase</span>
{
    <span class="pl-k">public</span> <span class="pl-en">AppHost</span>() : <span class="pl-c1">base</span>("MVC 4", typeof(MyServices).Assembly) {}

    <span class="pl-k">public</span> <span class="pl-k">override</span> <span class="pl-k">void</span> <span class="pl-en">Configure</span>(<span class="pl-k">Container</span> <span class="pl-smi">container</span>)
    {            
        ControllerBuilder.Current.SetControllerFactory(
            <span class="pl-k">new</span> FunqControllerFactory(container));
    }
}

[Route(<span class="pl-s"><span class="pl-pds">"</span>/hello/{Name}<span class="pl-pds">"</span></span>)]
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Hello</span>
{
    <span class="pl-k">public</span> <span class="pl-k">string</span> <span class="pl-en">Name</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyServices</span> : <span class="pl-k">Service</span>
{
    <span class="pl-k">public</span> <span class="pl-k">object</span> <span class="pl-en">Any</span>(<span class="pl-k">Hello</span> <span class="pl-smi">request</span>)
    {
        <span class="pl-k">return</span> request;
    }
}</pre></div>

<h3>
<a id="user-content-inferring-servicestacks-handlerfactorypath-api" class="anchor" href="#inferring-servicestacks-handlerfactorypath-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Inferring ServiceStack's HandlerFactoryPath (/api)</h3>

<p>Whilst ServiceStack automatically tries to infer the handler path based on the <code>&lt;location&gt;</code> tag, if there's an uncommon Web.config setup or there are some other issue inferring it, it' recommended to also explicitly set the <code>/api</code> handler path in <code>Config.HandlerFactoryPath</code>, e.g:</p>

<div class="highlight highlight-source-cs"><pre>SetConfig(<span class="pl-k">new</span> HostConfig { 
    HandlerFactoryPath = <span class="pl-s"><span class="pl-pds">"</span>api<span class="pl-pds">"</span></span>,
});</pre></div>

<h3>
<a id="user-content-initializing-servicestack" class="anchor" href="#initializing-servicestack" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Initializing ServiceStack</h3>

<p>Hosting in ASP.NET MVC is very similar to hosting in any ASP.NET framework, i.e. The ServiceStack AppHost still needs to be initialized on start up in your <code>Global.asax.cs</code> (or WebActivator), e.g:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Global</span> : <span class="pl-k">System</span>.<span class="pl-k">Web</span>.<span class="pl-k">HttpApplication</span>
{
    <span class="pl-k">protected</span> <span class="pl-k">void</span> <span class="pl-en">Application_Start</span>(<span class="pl-k">object</span> <span class="pl-smi">sender</span>, <span class="pl-k">EventArgs</span> <span class="pl-smi">e</span>)
    {
        <span class="pl-k">new</span> AppHost().Init();
    }
}</pre></div>

<p>You <em>MUST</em> also register ServiceStacks <code>/api</code> path by adding the lines below to MvcApplication.RegisterRoutes(RouteCollection) in the <strong>Global.asax</strong>:</p>

<div class="highlight highlight-source-cs"><pre>routes.IgnoreRoute(<span class="pl-s"><span class="pl-pds">"</span>api/{*pathInfo}<span class="pl-pds">"</span></span>); 
routes.IgnoreRoute(<span class="pl-s"><span class="pl-pds">"</span>{*favicon}<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> { favicon = <span class="pl-s"><span class="pl-pds">@"(.*/)?favicon.ico(/.*)?"</span></span> }); </pre></div>

<p>Place them before the current entries the method.</p>

<h3>
<a id="user-content-removing-web-api" class="anchor" href="#removing-web-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Removing Web API</h3>

<p>For MVC applications that include WebApi, you would need to unregister it by commenting out this line:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-c">//WebApiConfig.Register(GlobalConfiguration.Configuration);</span></pre></div>

<h2>
<a id="user-content-optional-configuration" class="anchor" href="#optional-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Optional Configuration</h2>

<h3>
<a id="user-content-sharing-dependencies-with-mvc-controllers" class="anchor" href="#sharing-dependencies-with-mvc-controllers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sharing dependencies with MVC Controllers</h3>

<p>To register all your dependencies in your ServiceStack AppHost, register an MVC Controller factory so both your MVC Controllers and ServiceStack services get auto-wired with these dependencies in your <code>AppHost.Configure()</code>, e.g:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">void</span> Configure(Funq.Container container) 
{
    <span class="pl-c">//Set MVC to use the same Funq IOC as ServiceStack</span>
    ControllerBuilder.Current.SetControllerFactory(
        <span class="pl-k">new</span> FunqControllerFactory(container));
}</pre></div>

<h3>
<a id="user-content-calling-servicestack-services-from-mvc-controllers" class="anchor" href="#calling-servicestack-services-from-mvc-controllers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Calling ServiceStack Services from MVC Controllers</h3>

<p>Just like in ServiceStack, you can retrieve an auto-wired Service and execute it using <code>HostContext.ResolveService&lt;TService&gt;()</code>, e.g:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> HelloController : ServiceStackController 
{
    <span class="pl-k">public</span> <span class="pl-k">void</span> Index(<span class="pl-k">string</span> name) 
    {
        <span class="pl-k">using</span> (<span class="pl-k">var</span> hello = HostContext.
            ResolveService&lt;HelloService&gt;(<span class="pl-c1">base</span>.HttpContext))
        {
           ViewBag.GreetResult = hello.Get(name).Result;
           <span class="pl-k">return</span> View();
        }
    }        
}</pre></div>

<p>Another cleaner way to share functionality between MVC and ServiceStack is to get them both injected with a shared dependency. See the <a href="http://stackoverflow.com/a/10572977">IGreeter example on StackOverflow</a>.</p>

<h3>
<a id="user-content-adding-mini-profiler" class="anchor" href="#adding-mini-profiler" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Adding Mini Profiler</h3>

<p>To enable the Mini Profiler add the following lines in to MvcApplication in <strong>Global.asax.cs</strong>:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">protected</span> <span class="pl-k">void</span> Application_BeginRequest(<span class="pl-k">object</span> src, EventArgs e)
{
    <span class="pl-k">if</span> (Request.IsLocal)
        ServiceStack.MiniProfiler.Profiler.Start();
}

<span class="pl-k">protected</span> <span class="pl-k">void</span> Application_EndRequest(<span class="pl-k">object</span> src, EventArgs e)
{
    ServiceStack.MiniProfiler.Profiler.Stop();
}</pre></div>

<p>For more info on the MiniProfiler see the [[Built in profiling]] wiki.</p>

<p>The Urls for metadata page and included Services:</p>

<ul>
<li>
<a href="http://bootstrapapi.servicestack.net/api/metadata">/api/metadata</a> - Auto generated metadata pages</li>
<li>
<a href="http://bootstrapapi.servicestack.net/api/hello/World">/api/hello</a> - Simple Hello World Service see: <a href="http://mono.servicestack.net/ServiceStack.Hello/">http://mono.servicestack.net/ServiceStack.Hello/</a>
</li>
<li>
<a href="http://bootstrapapi.servicestack.net/api/todos">/api/todos</a> - Simple REST Service see: <a href="http://todos.servicestack.net">http://todos.servicestack.net</a>
</li>
<li>
<a href="http://todos.servicestack.net/">/default.htm</a> - Backbone.js TODO application talking to the TODO REST service at /api/todos</li>
</ul>

<h2>
<a id="user-content-accessing-servicestack-from-mvc" class="anchor" href="#accessing-servicestack-from-mvc" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/ServiceStack/ServiceStack/wiki/ServiceStack-Integration">Accessing ServiceStack from MVC</a>
</h2>

<p>Once you have MVC + ServiceStack up and running checkout [[ServiceStack Integration]] docs to explore different ways of accessing ServiceStack from MVC.</p>
