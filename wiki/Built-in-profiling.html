<p>ServiceStack's <a href="https://github.com/ServiceStack/ServiceStack/wiki/HTML5ReportFormat">HTML5 JSON Report Format</a> also includes the excellent <a href="http://code.google.com/p/mvc-mini-profiler/">Mvc Mini Profiler</a> - by <a href="https://twitter.com/jarrod_dixon">@jarrod_dixon</a> and <a href="https://twitter.com/samsaffron">@samsaffron</a>.
It's the same profiler used to profile and help speed up sites like <a href="http://www.stackoverflow.com">Stack Overflow</a> and more recently the much faster <a href="http://nuget.org">NuGet v2.0</a> website.</p>

<p>As the MVC Mini Profiler is optimized for a .NET 4.0 MVC app, we've made some changes in order to integrate it into ServiceStack:</p>

<ul>
<li>Switched to using ServiceStack's much faster <a href="https://github.com/ServiceStack/ServiceStack.Text">Json Serializer</a>
</li>
<li>Reduced the overall footprint by replacing the use of jQuery and jQuery.tmpl with a much smaller <a href="https://github.com/mythz/jquip">jquip (jQuery-in-parts)</a> dependency.</li>
<li>Moved to the <strong>ServiceStack.MiniProfiler</strong> namespace and renamed to <strong>Profiler</strong> to avoid clashing with another Mvc Mini Profiler in the same project</li>
</ul>

<h3>
<a id="user-content-using-the-mvc-mini-profiler" class="anchor" href="#using-the-mvc-mini-profiler" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using the MVC Mini Profiler</h3>

<p>Just like the <a href="http://code.google.com/p/mvc-mini-profiler/">Normal Mvc Mini Profiler</a> you can enable it by starting it in your Global.asax, here's how to enable it for local requests:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">protected</span> <span class="pl-k">void</span> Application_BeginRequest(<span class="pl-k">object</span> src, EventArgs e)
{
    <span class="pl-k">if</span> (Request.IsLocal)
        Profiler.Start();
}

<span class="pl-k">protected</span> <span class="pl-k">void</span> Application_EndRequest(<span class="pl-k">object</span> src, EventArgs e)
{
    Profiler.Stop();
}</pre></div>

<p>Now if you also have ServiceStack Razor views you can enable the profiler by putting this into your _Layout.cshtml page:</p>

<div class="highlight highlight-source-cs"><pre>@ServiceStack.MiniProfiler.Profiler.RenderIncludes().AsRaw() </pre></div>

<p>That's it! Now everytime you view a web service or a razor page in your browser (locally) you'll see a profiler view of your service broken down in different stages:</p>

<p><a href="https://camo.githubusercontent.com/8f9702133035610dee7992017d450afc211a7c8d/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f6d696e6970726f66696c65722d68656c6c6f2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/8f9702133035610dee7992017d450afc211a7c8d/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f6d696e6970726f66696c65722d68656c6c6f2e706e67" alt="Hello MiniProfiler" data-canonical-src="http://mono.servicestack.net/files/miniprofiler-hello.png" style="max-width:100%;"></a></p>

<p>By default you get to see how long it took ServiceStack to de-serialize your request, run any Request / Response Filters and more importantly how long it took to <strong>Execute</strong> your service.</p>

<h2>
<a id="user-content-sql-profiling" class="anchor" href="#sql-profiling" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>SQL Profiling</h2>

<p>The profiler includes special support for SQL Profiling that can easily be enabled for OrmLite and Dapper by getting it to use a Profiled Connection using a ConnectionFilter:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-c1">this</span>.Container.Register&lt;IDbConnectionFactory&gt;(c =&gt;
    <span class="pl-k">new</span> OrmLiteConnectionFactory(
        <span class="pl-s"><span class="pl-pds">"</span>~/App_Data/db.sqlite<span class="pl-pds">"</span></span>.MapHostAbsolutePath(), SqliteDialect.Provider) {
            ConnectionFilter = x =&gt; <span class="pl-k">new</span> ProfiledDbConnection(x, Profiler.Current)
    });</pre></div>

<p>Refer to the <a href="http://code.google.com/p/mvc-mini-profiler/">Main MVC MiniProfiler home page</a> for instructions on how to configure profiling for Linq2Sql and EntityFramework.</p>

<p>It's also trivial to add custom steps enabling even finer-grained profiling for your services. 
Here's a <a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.WebHost.IntegrationTests/Services/ProfilerService.cs">simple web service DB example</a> 
returning a list of Movies using both a simple DB query and a dreaded N+1 query.</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MiniProfiler</span>
{
    <span class="pl-k">public</span> <span class="pl-k">string</span> <span class="pl-en">Type</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MiniProfilerService</span> : <span class="pl-k">Service</span>
{
    <span class="pl-k">public</span> <span class="pl-k">object</span> <span class="pl-en">Any</span>(<span class="pl-k">MiniProfiler</span> <span class="pl-smi">request</span>)
    {
        <span class="pl-k">var</span> profiler = Profiler.Current;

        <span class="pl-k">using</span> (profiler.Step(<span class="pl-s"><span class="pl-pds">"</span>MiniProfiler Service<span class="pl-pds">"</span></span>))
        {
            <span class="pl-k">if</span> (request.Type == <span class="pl-s"><span class="pl-pds">"</span>n1<span class="pl-pds">"</span></span>)
            {
                <span class="pl-k">using</span> (profiler.Step(<span class="pl-s"><span class="pl-pds">"</span>N + 1 query<span class="pl-pds">"</span></span>))
                {
                    <span class="pl-k">var</span> results = <span class="pl-k">new</span> List&lt;Movie&gt;();
                    <span class="pl-k">foreach</span> (<span class="pl-k">var</span> movie <span class="pl-k">in</span> Db.Select&lt;Movie&gt;())
                    {
                        results.Add(Db.QueryById&lt;Movie&gt;(movie.Id));
                    }
                    <span class="pl-k">return</span> results;
                }
            }

            <span class="pl-k">using</span> (profiler.Step(<span class="pl-s"><span class="pl-pds">"</span>Simple Select all<span class="pl-pds">"</span></span>))
            {
                <span class="pl-k">return</span> Db.Select&lt;Movie&gt;();
            }
        }
    }
}</pre></div>

<h2>
<a id="user-content-view-executed-sql" class="anchor" href="#view-executed-sql" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>View executed SQL</h2>

<p>Calling the above service normally provides the following Profiler output:</p>

<p><a href="https://camo.githubusercontent.com/ee24c6d11fe0d56ac19de6e9b6f1c47c7da13e44/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f6d696e6970726f66696c65722d73696d706c6564622e706e67" target="_blank"><img src="https://camo.githubusercontent.com/ee24c6d11fe0d56ac19de6e9b6f1c47c7da13e44/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f6d696e6970726f66696c65722d73696d706c6564622e706e67" alt="Simple DB Example" data-canonical-src="http://mono.servicestack.net/files/miniprofiler-simpledb.png" style="max-width:100%;"></a></p>

<p>Whilst calling the service with the <strong>n1</strong> param yields the following warning:</p>

<p><a href="https://camo.githubusercontent.com/fa823d1a9a1f42b53a5f1176ef1ba6f79e66f303/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f6d696e6970726f66696c65722d73696d706c6564622d6e312e706e67" target="_blank"><img src="https://camo.githubusercontent.com/fa823d1a9a1f42b53a5f1176ef1ba6f79e66f303/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f6d696e6970726f66696c65722d73696d706c6564622d6e312e706e67" alt="Simple N+1 DB Example" data-canonical-src="http://mono.servicestack.net/files/miniprofiler-simpledb-n1.png" style="max-width:100%;"></a></p>

<p>In both cases you see the actual SQL statements performed by clicking the <strong>SQL</strong> link. The N+1 query provides shows the following:</p>

<p><a href="https://camo.githubusercontent.com/1053dcf533cea051ae68ed8108f36d02b098b95e/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f6d696e6970726f66696c65722d73696d706c6564622d6e312d73716c2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/1053dcf533cea051ae68ed8108f36d02b098b95e/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f6d696e6970726f66696c65722d73696d706c6564622d6e312d73716c2e706e67" alt="N+1 DB Example SQL Statementes" data-canonical-src="http://mono.servicestack.net/files/miniprofiler-simpledb-n1-sql.png" style="max-width:100%;"></a></p>

<p>Notice the special attention the MVC MiniProfiler team put into identifying <strong>Duplicate</strong> queries - Thanks Guys!</p>

<h1>
<a id="user-content-community-resources" class="anchor" href="#community-resources" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Community Resources</h1>

<ul>
<li>
<a href="http://tunurgitr.blogspot.com/2012/04/miniprofiler-for-ajax-calls-with.html">MiniProfiler for AJAX calls with ServiceStack.Net</a> by <a href="https://plus.google.com/116988314718225555687/posts">+Jeff Harris</a>
</li>
</ul>
