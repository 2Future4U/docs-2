<p>The Cancellable Requests Feature makes it easy to design long-running Services that are cancellable with an external Web Service Request. To enable this feature, register the <code>CancellableRequestsFeature</code> plugin:</p>

<div class="highlight highlight-source-cs"><pre>Plugins.Add(<span class="pl-k">new</span> CancellableRequestsFeature());</pre></div>

<h3>
<a id="user-content-designing-a-cancellable-service" class="anchor" href="#designing-a-cancellable-service" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Designing a Cancellable Service</h3>

<p>Then in your Service you can wrap your implementation within a disposable <code>ICancellableRequest</code> block which encapsulates a Cancellation Token that you can watch to determine if the Request has been cancelled, e.g: </p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">object</span> Any(TestCancelRequest req)
{
    <span class="pl-k">using</span> (<span class="pl-k">var</span> cancellableRequest = <span class="pl-c1">base</span>.Request.CreateCancellableRequest())
    {
        <span class="pl-c">//Simulate long-running request</span>
        <span class="pl-k">while</span> (<span class="pl-c1">true</span>)
        {
            cancellableRequest.Token.ThrowIfCancellationRequested();
            Thread.Sleep(<span class="pl-c1">100</span>);
        }
    }
}</pre></div>

<h3>
<a id="user-content-cancelling-a-remote-service" class="anchor" href="#cancelling-a-remote-service" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cancelling a remote Service</h3>

<p>To be able to cancel a Server request on the client, the client must first <strong>Tag</strong> the request which it does by assigning the <code>X-Tag</code> HTTP Header with a user-defined string in a Request Filter before calling a cancellable Service, e.g:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> tag = Guid.NewGuid().ToString();
<span class="pl-k">var</span> client = <span class="pl-k">new</span> JsonServiceClient(baseUri) {
    RequestFilter = req =&gt; req.Headers[HttpHeaders.XTag] = tag
};

<span class="pl-k">var</span> responseTask = client.PostAsync(<span class="pl-k">new</span> TestCancelRequest());</pre></div>

<p>Then at anytime whilst the Service is still executing the remote request can be cancelled by calling the <code>CancelRequest</code> Service with the specified <strong>Tag</strong>, e.g: </p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> cancelResponse = client.Post(<span class="pl-k">new</span> CancelRequest { Tag = tag });</pre></div>

<p>If it was successfully cancelled it will return a <code>CancelRequestResponse</code> DTO with the elapsed time of how long the Service ran for. Otherwise if the remote Service had completed or never existed it will throw <strong>404 Not Found</strong> in a <code>WebServiceException</code>.</p>
