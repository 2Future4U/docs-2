<h2>
<a id="user-content-http-custom-hooks" class="anchor" href="#http-custom-hooks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>HTTP Custom hooks</h2>

<p>This list shows the order in which any user-defined custom hooks are executed:</p>

<ol>
<li>
<code>HostContext.RawHttpHandlers</code> are executed before anything else, i.e. returning any ASP.NET <code>IHttpHandler</code> by-passes ServiceStack completely and processes your custom <code>IHttpHandler</code> instead.</li>
<li>If the Request doesn't match any existing Routes it will search <code>IAppHost.CatchAllHandlers</code> for a match</li>
<li>The <code>IAppHost.PreRequestFilters</code> gets executed before the Request DTO is deserialized</li>
<li>Default Request DTO Binding or <a href="https://github.com/ServiceStack/ServiceStack/wiki/Serialization-deserialization">Custom Request Binding</a> <em>(if registered)</em>
</li>
<li>Any <a href="https://github.com/ServiceStack/ServiceStack/wiki/Customize-HTTP-Responses#request-converters">Request Converters</a> are executed</li>
<li>
<a href="https://github.com/ServiceStack/ServiceStack/wiki/Filter-attributes">Request Filter Attributes</a> with <strong>Priority &lt; 0</strong> gets executed</li>
<li>Then any <a href="https://github.com/ServiceStack/ServiceStack/wiki/Request-and-response-filters">Global Request Filters</a> get executed</li>
<li>Followed by <a href="https://github.com/ServiceStack/ServiceStack/wiki/Filter-attributes">Request Filter Attributes</a> with <strong>Priority &gt;= 0</strong>
</li>
<li>Action Request Filters</li>
<li>Then your <strong>Service is executed</strong> with the configured <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Web/IServiceRunner.cs">IServiceRunner</a> and its <strong>OnBeforeExecute</strong>, <strong>OnAfterExecute</strong> and <strong>HandleException</strong> custom hooks are fired</li>
<li>Action Response Filters</li>
<li>Any <a href="https://github.com/ServiceStack/ServiceStack/wiki/Customize-HTTP-Responses#response-converters">Response Converters</a> are executed</li>
<li>Followed by <a href="https://github.com/ServiceStack/ServiceStack/wiki/Filter-attributes">Response Filter Attributes</a> with <strong>Priority &lt; 0</strong> </li>
<li>Then <a href="https://github.com/ServiceStack/ServiceStack/wiki/Request-and-response-filters">Global Response Filters</a> </li>
<li>Followed by <a href="https://github.com/ServiceStack/ServiceStack/wiki/Filter-attributes">Response Filter Attributes</a> with <strong>Priority &gt;= 0</strong> </li>
<li>Finally at the end of the Request <code>IAppHost.OnEndRequest</code> and any <code>IAppHost.OnEndRequestCallbacks</code> are fired</li>
</ol>

<p>Any time you close the Response in any of your filters, i.e. <code>httpRes.EndRequest()</code> the processing of the response is short-circuited and no further processing is done on that request.</p>

<h2>
<a id="user-content-mq-non-http-custom-hooks" class="anchor" href="#mq-non-http-custom-hooks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MQ (non-HTTP) Custom hooks</h2>

<ol>
<li>Any <a href="https://github.com/ServiceStack/ServiceStack/wiki/Request-and-response-filters#message-queue-endpoints">Global Request Filters</a> get executed</li>
<li>Followed by <a href="https://github.com/ServiceStack/ServiceStack/wiki/Filter-attributes">Request Filter Attributes</a> with <strong>Priority &gt;= 0</strong>
</li>
<li>Action Request Filters</li>
<li>Then your <strong>Service is executed</strong> with the configured <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Web/IServiceRunner.cs">IServiceRunner</a> and its <strong>OnBeforeExecute</strong>, <strong>OnAfterExecute</strong> and <strong>HandleException</strong> custom hooks are fired</li>
<li>Action Response Filters</li>
<li>Then <a href="https://github.com/ServiceStack/ServiceStack/wiki/Request-and-response-filters#message-queue-endpoints">Global Response Filters</a> </li>
<li>Finally at the end of the Request <code>IAppHost.OnEndRequest</code> is fired</li>
</ol>

<h2>
<a id="user-content-implementation-architecture-diagram" class="anchor" href="#implementation-architecture-diagram" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Implementation architecture diagram</h2>

<p>The <a href="https://github.com/ServiceStack/ServiceStack/wiki/Architecture-overview">Implementation architecture diagram</a> shows a visual cue of the internal order of operations that happens in ServiceStack:</p>

<p><a href="https://camo.githubusercontent.com/c2122c5f089d88056a8fa0d8fa3d77d443c810e4/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f73657276696365737461636b2d6f766572766965772d30312e706e67" target="_blank"><img src="https://camo.githubusercontent.com/c2122c5f089d88056a8fa0d8fa3d77d443c810e4/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f73657276696365737461636b2d6f766572766965772d30312e706e67" alt="ServiceStack Overview" data-canonical-src="http://mono.servicestack.net/files/servicestack-overview-01.png" style="max-width:100%;"></a></p>

<p>After the IHttpHandler is returned, it gets executed with the current ASP.NET or HttpListener request wrapped in a common <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/ServiceHost/IHttpRequest.cs">IHttpRequest</a> instance. </p>

<p>The implementation of <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/WebHost.Endpoints/RestHandler.cs">RestHandler</a> shows what happens during a typical ServiceStack request:</p>

<p><a href="https://camo.githubusercontent.com/4eb680d1a2ee48fa1d3f58356827804988cc2c90/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f73657276696365737461636b2d6f766572766965772d30322e706e67" target="_blank"><img src="https://camo.githubusercontent.com/4eb680d1a2ee48fa1d3f58356827804988cc2c90/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f73657276696365737461636b2d6f766572766965772d30322e706e67" alt="ServiceStack Request Pipeline" data-canonical-src="http://mono.servicestack.net/files/servicestack-overview-02.png" style="max-width:100%;"></a></p>
