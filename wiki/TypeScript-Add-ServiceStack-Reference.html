<p><a href="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/wikis/typescript-banner.png" target="_blank"><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/wikis/typescript-banner.png" alt="ServiceStack and TypeScript Banner" style="max-width:100%;"></a></p>

<p>ServiceStack's <strong>Add ServiceStack Reference</strong> feature allows clients to generate Native Types from directly within VS.NET using <a href="https://github.com/ServiceStack/ServiceStack/wiki/Creating-your-first-project">ServiceStackVS VS.NET Extension</a> - providing a simple way to give clients typed access to your ServiceStack Services.</p>

<p><a href="http://www.typescriptlang.org/">TypeScript</a> is a superset of JavaScript that enhances it with an optional type system for annotating existing JavaScript data structures - bringing many of the code-analysis, insights and tooling benefits that we get to enjoy developing in a typed language like C#/VS.NET. </p>

<p>This article outlines ServiceStack's support for generating TypeScript DTO definitions - allowing JavaScript clients to benefit from TypeScript's strong typing feedback valuable during development when consuming evolvable Web API's by adding a reference to a remote ServiceStack instance directly from within VS.NET.</p>

<h3>
<a id="user-content-typescript-ambient-interface-definitions-or-concrete-types" class="anchor" href="#typescript-ambient-interface-definitions-or-concrete-types" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>TypeScript Ambient Interface Definitions or Concrete Types</h3>

<p>Use the <code>ExportAsTypes=true</code> option to generate non-ambient concrete TypeScript Types. This option is enabled at the 
new <code>/types/typescript</code> route so you can get both concrete types and interface definitions at:</p>

<ul>
<li>
<a href="http://techstacks.io/types/typescript">/types/typescript</a> - for generating concrete module and classes</li>
<li>
<a href="http://techstacks.io/types/typescript.d">/types/typescript.d</a> - for generating ambient interface definitions</li>
</ul>

<h2>
<a id="user-content-add-servicestack-reference" class="anchor" href="#add-servicestack-reference" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>[[Add ServiceStack Reference]]</h2>

<p>The easiest way to Add a ServiceStack reference to your project is to <strong>right-click</strong> on your project to bring up <a href="https://github.com/ServiceStack/ServiceStack/wiki/Creating-your-first-project">ServiceStackVS's</a> VS.NET context-menu item, then click on <code>Add -&gt; TypeScript Reference...</code>. This opens a dialog where you can add the url of the ServiceStack instance you want to typed DTO's for, as well as the name of the DTO source file that's added to your project.</p>

<p><a href="https://github.com/ServiceStack/Assets/blob/master/img/servicestackvs/add-typescript-reference-js.png"><img src="https://github.com/ServiceStack/Assets/raw/master/img/servicestackvs/add-typescript-reference-js.png" alt="Add ServiceStack Reference" style="max-width:100%;"></a></p>

<p>After clicking OK, the servers DTO's are added to the project, yielding an instant typed API:</p>

<p><a href="https://github.com/ServiceStack/Assets/blob/master/img/servicestackvs/add-typescript-reference-dtos.png" target="_blank"><img src="https://github.com/ServiceStack/Assets/raw/master/img/servicestackvs/add-typescript-reference-dtos.png" alt="TypeScript native types" style="max-width:100%;"></a></p>

<h3>
<a id="user-content-update-servicestack-reference" class="anchor" href="#update-servicestack-reference" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update ServiceStack Reference</h3>

<p>If your server has been updated and you want to update the client DTOs, simply <strong>right-click</strong> on the DTO file within VS.NET and select <strong>Update ServiceStack Reference</strong>, alternatively modifying or <strong>Saving</strong> the generated <code>*.dtos.d.ts</code> file also instructs <strong>ServiceStackVS</strong> to download a fresh update. </p>

<h2>
<a id="user-content-typescript-interface-definitions" class="anchor" href="#typescript-interface-definitions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>TypeScript Interface Definitions</h2>

<p>The Native TypeScript DTO's are made available in the form of a <a href="http://www.typescriptlang.org/Handbook#writing-dts-files">TypeScript declaration file</a> (.d.ts). TypeScript declarations are just pure static type annotations, i.e. they don't generate any code or otherwise have any effect on runtime behavior. This makes them useful as a non-invasive drop-in into existing JavaScript code where it's just used to provide type annotations on existing JavaScript objects, letting you continue using your existing data types and ajax libraries.</p>

<h3>
<a id="user-content-typescript-reference-example" class="anchor" href="#typescript-reference-example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>TypeScript Reference Example</h3>

<p>Lets walk through a simple example to see how we can use ServiceStack's TypeScript DTO annotations in our JavaScript clients. Firstly we'll need to add a TypeScript Reference to the remote ServiceStack Service by <strong>right-clicking</strong> on your project and clicking on <code>Add &gt; TypeScript Reference...</code> (as seen in the above screenshot).</p>

<p>This will import the remote Services dtos into your local project which looks similar to:</p>

<pre><code>/* Options:
Date: 2014-12-08 17:24:02
Version: 1
BaseUrl: http://api.example.com

GlobalNamespace: dtos
//MakePropertiesOptional: True
//AddServiceStackTypes: True
//AddResponseStatus: False
*/

declare module dtos
{
    // @Route("/hello")
    // @Route("/hello/{Name}")
    interface Hello extends IReturn&lt;HelloResponse&gt;
    {
        // @Required()
        name: string;
        title?: string;
    }

    interface HelloResponse
    {
        result?:string;
    }

    interface IReturn&lt;T&gt; {}
    ...
}
</code></pre>

<p>Initially the TypeScript module containing all the DTO definitions will default to the C#/.NET Service Model namespace, but can be made more readable by adding<code>GlobalNamespace: dtos</code> in the header properties.</p>

<p>Looking at the types we'll notice the DTO's are just interface type definitions with any .NET attributes added in comments using AtScript's proposed <a href="https://docs.google.com/document/d/11YUzC-1d0V1-Q3V0fQ7KSit97HnZoKVygDxpWzEYW0U/mobilebasic?viewopt=127">meta-data annotations format</a>. This lets you view helpful documentation about your DTO's like the different custom routes available for each Request DTO.</p>

<p>By default DTO properties are optional but can be made a required field by annotating the .NET property with the <code>[Required]</code> attribute or by uncommenting <code>MakePropertiesOptional: False</code> in the header comments which instead defaults to using required properties.</p>

<p>Properties always reflect to match the remote servers JSON Serialization configuration, i.e. will use <strong>camelCase</strong> properties when the <code>AppHost</code> is configured with:</p>

<div class="highlight highlight-source-cs"><pre>JsConfig.EmitCamelCaseNames = <span class="pl-c1">true</span>;</pre></div>

<h3>
<a id="user-content-referencing-typescript-dtos" class="anchor" href="#referencing-typescript-dtos" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Referencing TypeScript DTO's</h3>

<p>Once added to your project, use VS.NET's JavaScript doc comments to reference the TypeScript definitions in your <code>.ts</code> scripts. The example below shows how to use the above TypeScript definitions to create a typed Request/Response utilizing jQuery's Ajax API to fire off a new Ajax request on every keystroke:</p>

<div class="highlight highlight-text-html-basic"><pre>/// &lt;<span class="pl-ent">reference</span> <span class="pl-e">path</span>=<span class="pl-s"><span class="pl-pds">"</span>MyApis.dtos.d.ts<span class="pl-pds">"</span></span>/&gt;
...

&lt;<span class="pl-ent">input</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>txtHello<span class="pl-pds">"</span></span> <span class="pl-e">data-keyup</span>=<span class="pl-s"><span class="pl-pds">"</span>sayHello<span class="pl-pds">"</span></span> /&gt; 
&lt;<span class="pl-ent">div</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>result<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">div</span>&gt;

<span class="pl-s1">&lt;<span class="pl-ent">script</span>&gt;</span>
<span class="pl-s1"><span class="pl-en">$</span>(<span class="pl-c1">document</span>).<span class="pl-en">bindHandlers</span>({</span>
<span class="pl-s1">    <span class="pl-en">sayHello</span><span class="pl-k">:</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">        <span class="pl-k">var</span> request<span class="pl-k">:</span> <span class="pl-smi">dtos</span>.<span class="pl-smi">Hello</span> <span class="pl-k">=</span> {};</span>
<span class="pl-s1">        <span class="pl-smi">request</span>.<span class="pl-c1">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Dr<span class="pl-pds">"</span></span>;</span>
<span class="pl-s1">        <span class="pl-smi">request</span>.<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-v">this</span>.<span class="pl-c1">value</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$</span>.<span class="pl-en">getJSON</span>(<span class="pl-en">createUrl</span>(<span class="pl-s"><span class="pl-pds">"</span>/hello<span class="pl-pds">"</span></span>, request), request, </span>
<span class="pl-s1">            <span class="pl-k">function</span> (<span class="pl-smi">r</span><span class="pl-k">:</span> <span class="pl-smi">dtos</span>.<span class="pl-smi">HelloResponse</span>) {</span>
<span class="pl-s1">                <span class="pl-en">$</span>(<span class="pl-s"><span class="pl-pds">"</span>#result<span class="pl-pds">"</span></span>).<span class="pl-en">html</span>(<span class="pl-smi">r</span>.<span class="pl-smi">result</span>);</span>
<span class="pl-s1">            });</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">});</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">function</span> <span class="pl-en">createUrl</span>(<span class="pl-smi">path</span><span class="pl-k">:</span> <span class="pl-smi">string</span>, <span class="pl-smi">params</span><span class="pl-k">:</span> <span class="pl-smi">any</span>): string {</span>
<span class="pl-s1">    <span class="pl-k">for</span> (<span class="pl-k">var</span> key <span class="pl-k">in</span> params) {</span>
<span class="pl-s1">        path <span class="pl-k">+=</span> <span class="pl-smi">path</span>.<span class="pl-c1">indexOf</span>(<span class="pl-s"><span class="pl-pds">'</span>?<span class="pl-pds">'</span></span>) <span class="pl-k">&lt;</span> <span class="pl-c1">0</span> <span class="pl-k">?</span> <span class="pl-s"><span class="pl-pds">"</span>?<span class="pl-pds">"</span></span> <span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>&amp;<span class="pl-pds">"</span></span>;</span>
<span class="pl-s1">        path <span class="pl-k">+=</span> key <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-c1">encodeURIComponent</span>(params[key]);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">    <span class="pl-k">return</span> path;</span>
<span class="pl-s1">}</span>
<span class="pl-s1">&lt;/<span class="pl-ent">script</span>&gt;</span></pre></div>

<p>Here we're just using a simple inline <code>createUrl()</code> function to show how we're creating the url for the <strong>GET</strong> HTTP Request by appending all Request DTO properties in the QueryString, resulting in a HTTP GET Request that looks like:</p>

<pre><code>/hello?title=Dr&amp;name=World
</code></pre>

<p>There's also a new <code>$.ss.createUrl()</code> API in <a href="https://github.com/ServiceStack/ServiceStack/wiki/ss-utils.js-JavaScript-Client-Library">ss-utils.js</a> which also handles .NET Route definitions where it will populate any variables in the <code>/path/{info}</code> instead of adding them to the <code>?QueryString</code>, e.g:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-en">$</span>(<span class="pl-c1">document</span>).<span class="pl-en">bindHandlers</span>({
    <span class="pl-en">sayHello</span><span class="pl-k">:</span> <span class="pl-k">function</span> () {
        <span class="pl-k">var</span> request<span class="pl-k">:</span> <span class="pl-smi">dtos</span>.<span class="pl-smi">Hello</span> <span class="pl-k">=</span> {};
        <span class="pl-smi">request</span>.<span class="pl-c1">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Dr<span class="pl-pds">"</span></span>;
        <span class="pl-smi">request</span>.<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-v">this</span>.<span class="pl-c1">value</span>;

        <span class="pl-smi">$</span>.<span class="pl-en">getJSON</span>(<span class="pl-smi">$</span>.<span class="pl-smi">ss</span>.<span class="pl-en">createUrl</span>(<span class="pl-s"><span class="pl-pds">"</span>/hello/{Name}<span class="pl-pds">"</span></span>, request), request, 
            <span class="pl-k">function</span> (<span class="pl-smi">r</span><span class="pl-k">:</span> <span class="pl-smi">dtos</span>.<span class="pl-smi">HelloResponse</span>) {
                <span class="pl-en">$</span>(<span class="pl-s"><span class="pl-pds">"</span>#result<span class="pl-pds">"</span></span>).<span class="pl-en">html</span>(<span class="pl-smi">r</span>.<span class="pl-smi">result</span>);
            });
    }
});</pre></div>

<p>Which results in a HTTP GET request with the expected Url:</p>

<pre><code>/hello/World?title=Dr
</code></pre>

<h2>
<a id="user-content-dto-customization-options" class="anchor" href="#dto-customization-options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DTO Customization Options</h2>

<p>The header in the generated DTO's show the different options TypeScript native types support with their defaults. Default values are shown with the comment prefix of <code>//</code>. To override a value, remove the <code>//</code> and specify the value to the right of the <code>:</code>. Any uncommented value will be sent to the server to override any server defaults.</p>

<p>The DTO comments allows for customizations for how DTOs are generated. The default options that were used to generate the DTO's are repeated in the header comments of the generated DTOs, options that are preceded by a TypeScript comment <code>//</code> are defaults from the server, any uncommented value will be sent to the server to override any server defaults.</p>

<div class="highlight highlight-source-ts"><pre><span class="pl-c">/* Options:</span>
<span class="pl-c">Date: 2015-11-21 00:32:00</span>
<span class="pl-c">Version: 4.048</span>
<span class="pl-c">BaseUrl: </span>
<span class="pl-c"></span>
<span class="pl-c">GlobalNamespace: dtos</span>
<span class="pl-c">//ExportAsTypes: False</span>
<span class="pl-c">//MakePropertiesOptional: True</span>
<span class="pl-c">//AddServiceStackTypes: True</span>
<span class="pl-c">//AddResponseStatus: False</span>
<span class="pl-c">//AddImplicitVersion: </span>
<span class="pl-c">//IncludeTypes: </span>
<span class="pl-c">//ExcludeTypes: </span>
<span class="pl-c">//DefaultImports: </span>
<span class="pl-c">*/</span></pre></div>

<p>We'll go through and cover each of the above options to see how they affect the generated DTO's:</p>

<h3>
<a id="user-content-change-default-server-configuration" class="anchor" href="#change-default-server-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Change Default Server Configuration</h3>

<p>The above defaults are also overridable on the ServiceStack Server by modifying the default config on the <code>NativeTypesFeature</code> Plugin, e.g:</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-c">//Server example in CSharp</span>
<span class="pl-k">var</span> nativeTypes = <span class="pl-c1">this</span>.GetPlugin&lt;NativeTypesFeature&gt;();
nativeTypes.MetadataTypesConfig.GlobalNamespace = <span class="pl-s"><span class="pl-pds">"</span>dtos<span class="pl-pds">"</span></span>;
...</pre></div>

<p>We'll go through and cover each of the above options to see how they affect the generated DTO's:</p>

<h3>
<a id="user-content-globalnamespace" class="anchor" href="#globalnamespace" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GlobalNamespace</h3>

<p>Changes the name of the module that contain the generated TypeScript definitions:</p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">declare</span> <span class="pl-k">module</span> dtos
{
    ...
}</pre></div>

<h3>
<a id="user-content-exportastypes" class="anchor" href="#exportastypes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ExportAsTypes</h3>

<p>Changes whether types should be generated as ambient interface definitions or exported as concrete Types:</p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">module</span> dtos
{
    <span class="pl-k">export</span> <span class="pl-k">interface</span> <span class="pl-en">IReturnVoid</span>
    {
    }
    ...
}</pre></div>

<h3>
<a id="user-content-makepropertiesoptional" class="anchor" href="#makepropertiesoptional" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MakePropertiesOptional</h3>

<p>Changes whether the default of whether each property is optional or not:</p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">interface</span> <span class="pl-en">Answer</span>
{
    <span class="pl-v">AnswerId</span>: <span class="pl-k">number</span>;
    <span class="pl-v">Owner</span>: User;
    <span class="pl-v">IsAccepted</span>: <span class="pl-k">boolean</span>;
    <span class="pl-v">Score</span>: <span class="pl-k">number</span>;
    <span class="pl-v">LastActivityDate</span>: <span class="pl-k">number</span>;
    <span class="pl-v">LastEditDate</span>: <span class="pl-k">number</span>;
    <span class="pl-v">CreationDate</span>: <span class="pl-k">number</span>;
    <span class="pl-v">QuestionId</span>: <span class="pl-k">number</span>;
}</pre></div>

<h3>
<a id="user-content-addresponsestatus" class="anchor" href="#addresponsestatus" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AddResponseStatus</h3>

<p>Automatically add a <code>ResponseStatus</code> property on all Response DTO's, regardless if it wasn't already defined:</p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">interface</span> <span class="pl-en">GetAnswers</span> <span class="pl-k">extends</span> <span class="pl-k">IReturn</span>&lt;GetAnswersResponse&gt;
{
    ...
    <span class="pl-v">ResponseStatus</span>: ResponseStatus;
}</pre></div>

<h3>
<a id="user-content-addimplicitversion" class="anchor" href="#addimplicitversion" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AddImplicitVersion</h3>

<p>Lets you specify the Version number to be automatically populated in all Request DTO's sent from the client: </p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">interface</span> <span class="pl-en">GetAnswers</span> <span class="pl-k">extends</span> <span class="pl-k">IReturn</span>&lt;GetAnswersResponse&gt;
{
    <span class="pl-v">Version</span>: <span class="pl-k">number</span>; <span class="pl-c">//1</span>
    ...
}</pre></div>

<p>This lets you know what Version of the Service Contract that existing clients are using making it easy to implement ServiceStack's <a href="http://stackoverflow.com/a/12413091/85785">recommended versioning strategy</a>. </p>
